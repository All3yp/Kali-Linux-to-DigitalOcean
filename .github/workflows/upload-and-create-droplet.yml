name: Create DigitalOcean Droplet

on:
  workflow_dispatch:

jobs:
  create-droplet:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v4
      
      - name: Create Droplet on DigitalOcean
        run: |
          set -e
          response=$(curl -s -w "%{http_code}" -o response.json -X POST "https://api.digitalocean.com/v2/droplets" \
            -H "Authorization: Bearer ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d "{
                  \"name\": \"kali-droplet\",
                  \"region\": \"nyc3\",
                  \"size\": \"s-1vcpu-1gb\",
                  \"image\": \"custom-image-id\",
                  \"ssh_keys\": [\"${{ secrets.DVPS_KEY }}\"],
                  \"backups\": false,
                  \"ipv6\": true,
                  \"tags\": [\"kali-droplet\"]
                }")
          if [ "$response" -ne 200 ] && [ "$response" -ne 202 ]; then
            cat response.json
            echo "‚ùå Error creating the Droplet!"
            exit 1
          fi
